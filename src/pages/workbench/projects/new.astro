---
import WorkbenchLayout from '../../../components/layouts/WorkbenchLayout.astro';
import Breadcrumb from '../../../components/ui/Breadcrumb';
import FormInput from '../../../components/ui/redesign/FormInput.astro';
import FormTextarea from '../../../components/ui/redesign/FormTextarea.astro';
import FormSelect from '../../../components/ui/redesign/FormSelect.astro';
import { createSupabaseServer } from '../../../lib/supabaseServer';

// Get user
const supabase = createSupabaseServer(Astro.cookies);
const { data: { user } } = await supabase.auth.getUser();

if (!user) {
  return Astro.redirect('/login');
}
---

<WorkbenchLayout title="New Project - Workspace">
  <!-- Breadcrumb -->
  <Breadcrumb
    client:load
    items={[
      { label: 'Dashboard', href: '/' },
      { label: 'Projects', href: '/projects' },
      { label: 'New Project' }
    ]}
  />

  <!-- Page Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">
      Create New Project
    </h1>
    <p class="text-base text-gray-600 dark:text-gray-400 mt-2">
      Start a new research project to organize your work and updates.
    </p>
  </div>

  <!-- Project Creation Form -->
  <div class="content-section max-w-3xl">
    <form method="POST" action="/api/projects" class="space-y-6">
      <!-- Project Title -->
      <FormInput
        name="name"
        label="Project Title"
        placeholder="Enter a clear, descriptive title"
        required={true}
        hint="Choose a title that explains what you're working on"
      />

      <!-- Project Description -->
      <FormTextarea
        name="description"
        label="Description"
        placeholder="What are you researching or building? What problem are you solving?"
        rows={4}
        hint="Provide context for collaborators and your future self"
      />

      <!-- Project Type -->
      <FormSelect
        name="category"
        label="Project Type"
        options={[
          { value: 'research', label: 'Research' },
          { value: 'development', label: 'Development' },
          { value: 'writing', label: 'Writing' },
          { value: 'learning', label: 'Learning' },
          { value: 'other', label: 'Other' }
        ]}
      />

      <!-- Visibility -->
      <div class="form-control">
        <label class="form-label">
          Visibility
        </label>
        <div class="flex gap-4 mt-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="visibility" value="private" class="radio-input" checked />
            <span class="text-sm font-medium">Private</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input type="radio" name="visibility" value="public" class="radio-input" />
            <span class="text-sm font-medium">Public</span>
          </label>
        </div>
        <div class="form-hint mt-2">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Private projects are only visible to you</span>
        </div>
      </div>

      <div class="border-t border-gray-200 dark:border-gray-700 my-6"></div>

      <!-- Form Actions -->
      <div class="flex gap-3 justify-end">
        <a href="/projects" class="btn-ghost">Cancel</a>
        <button type="submit" class="btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
          </svg>
          Create Project
        </button>
      </div>
    </form>
  </div>

  <!-- Tips Card -->
  <div class="content-section max-w-3xl mt-6 bg-gray-50 dark:bg-gray-800/50">
    <h3 class="font-semibold flex items-center gap-2 mb-3">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-primary">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18" />
      </svg>
      Tips for Projects
    </h3>
    <ul class="text-sm space-y-2 text-gray-600 dark:text-gray-400">
      <li>• Use clear, descriptive titles that explain the purpose</li>
      <li>• Add context in the description to help collaborators understand</li>
      <li>• Start with private visibility until you're ready to share</li>
      <li>• Projects help you organize updates into meaningful sub-projects</li>
    </ul>
  </div>
</WorkbenchLayout>
