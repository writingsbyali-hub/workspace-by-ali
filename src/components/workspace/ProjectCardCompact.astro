---
interface Props {
  slug: string;
  title: string;
  description?: string;
  category?: string;
  gated?: boolean;
  status?: string;
  lastUpdated?: string;
  tags?: string[];
}

const {
  slug,
  title,
  description,
  category,
  gated = false,
  status,
  lastUpdated,
  tags = []
} = Astro.props;

// Format last updated date
const formatDate = (dateString?: string) => {
  if (!dateString) return 'Recently';
  const date = new Date(dateString);
  const now = new Date();
  const diffTime = Math.abs(now.getTime() - date.getTime());
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 0) return 'Today';
  if (diffDays === 1) return 'Yesterday';
  if (diffDays < 7) return `${diffDays} days ago`;
  if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
  if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
  return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
};

// Category badge colors
const categoryColors: Record<string, string> = {
  hardware: 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300',
  biology: 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300',
  plasma: 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300',
  'data-science': 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300',
  other: 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300',
};

const categoryColor = category ? (categoryColors[category] || categoryColors.other) : categoryColors.other;
---

<a href={`/projects/${slug}`} class="project-card-compact">
  <!-- Cover placeholder (gradient based on category) -->
  <div class="card-cover" data-category={category}>
    <div class="cover-overlay">
      {gated && (
        <div class="gated-badge">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
          </svg>
          Gated
        </div>
      )}
    </div>
  </div>

  <!-- Card content -->
  <div class="card-content">
    <div class="card-header">
      <h4 class="card-title">{title}</h4>
      {category && (
        <span class={`category-badge ${categoryColor}`}>
          {category}
        </span>
      )}
    </div>

    {description && (
      <p class="card-description line-clamp-2">
        {description}
      </p>
    )}

    <div class="card-meta">
      <span class="meta-date">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        {formatDate(lastUpdated)}
      </span>

      {status && (
        <span class={`status-badge status-${status}`}>
          {status}
        </span>
      )}
    </div>
  </div>
</a>

<style>
  .project-card-compact {
    flex: 0 0 280px; /* Fixed width for horizontal scrolling */
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem;
    overflow: hidden;
    transition: all 0.2s ease;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    cursor: pointer;
  }

  .project-card-compact:hover {
    transform: translateY(-4px);
    border-color: var(--primary);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
  }

  /* Cover placeholder with gradient */
  .card-cover {
    width: 100%;
    height: 140px;
    position: relative;
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--bg-hover) 100%);
  }

  .card-cover[data-category="hardware"] {
    background: linear-gradient(135deg, #3B82F6 0%, #60A5FA 100%);
  }

  .card-cover[data-category="biology"] {
    background: linear-gradient(135deg, #00D084 0%, #10B981 100%);
  }

  .card-cover[data-category="plasma"] {
    background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 100%);
  }

  .card-cover[data-category="data-science"] {
    background: linear-gradient(135deg, #F59E0B 0%, #FBBF24 100%);
  }

  .cover-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: flex-start;
    justify-content: flex-end;
    padding: 0.75rem;
  }

  .gated-badge {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    color: white;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
  }

  /* Card content */
  .card-content {
    padding: 1rem;
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .card-header {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .card-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.3;
    margin: 0;
  }

  .category-badge {
    font-size: 0.75rem;
    font-weight: 500;
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    text-transform: capitalize;
    width: fit-content;
  }

  .card-description {
    font-size: 0.875rem;
    color: var(--text-muted);
    line-height: 1.4;
    margin: 0;
    flex: 1;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Card meta */
  .card-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.75rem;
    color: var(--text-muted);
    padding-top: 0.5rem;
    border-top: 1px solid var(--border-color);
  }

  .meta-date {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .status-badge {
    padding: 0.125rem 0.5rem;
    border-radius: 0.25rem;
    font-weight: 500;
    text-transform: capitalize;
  }

  .status-draft {
    background: var(--bg-hover);
    color: var(--text-muted);
  }

  .status-active {
    background: rgba(0, 208, 132, 0.1);
    color: var(--primary);
  }

  .status-archived {
    background: var(--bg-hover);
    color: var(--text-tertiary);
  }

  /* Mobile adjustments */
  @media (max-width: 768px) {
    .project-card-compact {
      flex: 0 0 240px;
    }

    .card-cover {
      height: 120px;
    }

    .card-content {
      padding: 0.875rem;
    }

    .card-title {
      font-size: 0.9375rem;
    }
  }
</style>
