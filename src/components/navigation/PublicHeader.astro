---
import { publicNavigation } from '../../lib/navigation';

interface Props {
  currentPath: string;
  isOwner: boolean;
  user: any | null;
}

const { currentPath, isOwner, user } = Astro.props;

// Helper function to determine active state
const isActive = (path: string) => {
  if (path === '/' && currentPath === '/') return true;
  if (path !== '/' && currentPath.startsWith(path)) return true;
  return false;
};
---

<header class="public-header">
  <div class="header-container">
    <!-- Logo -->
    <div class="header-logo">
      <a href="/" class="logo-link">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="logo-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
        </svg>
        <span class="logo-text">Workspace</span>
      </a>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" id="mobileMenuToggle">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="menu-icon">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
      </svg>
    </button>

    <!-- Navigation -->
    <nav class="header-nav" id="headerNav">
      {publicNavigation.map((item) => (
        <a
          href={item.path}
          class={`nav-link ${isActive(item.path) ? 'active' : ''}`}
        >
          {item.label}
        </a>
      ))}
    </nav>

    <!-- Actions -->
    <div class="header-actions">
      <!-- Theme Toggle -->
      <button class="theme-toggle-btn" id="themeToggle" aria-label="Toggle dark mode">
        <!-- Sun icon (shown in light mode) -->
        <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
        </svg>
        <!-- Moon icon (shown in dark mode) -->
        <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
        </svg>
      </button>

      <!-- CTA Button -->
      {isOwner ? (
        <a href="/workbench" class="cta-button cta-owner">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="cta-icon">
            <path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-2.25-2.25l3.276-3.276a4.5 4.5 0 00-6.336 4.486c.091 1.076-.071 2.264-.904 2.95l-.102.085m-1.745 1.437L5.909 7.5H4.5L2.25 3.75l1.5-1.5L7.5 4.5v1.409l4.26 4.26m-1.745 1.437l1.745-1.437m6.615 8.206L15.75 15.75M4.867 19.125h.008v.008h-.008v-.008z" />
          </svg>
          Workbench
        </a>
      ) : (
        <a href="/start" class="cta-button cta-get-workspace">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="cta-icon">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" />
          </svg>
          Get Workspace
        </a>
      )}
    </div>
  </div>
</header>

<style>
  .public-header {
    background: rgba(var(--bg-secondary-rgb, 249, 250, 251), 0.95);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  [data-theme="workspace-dark"] .public-header {
    background: rgba(var(--bg-secondary-rgb, 15, 20, 25), 0.95);
  }

  .header-container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
  }

  /* Logo */
  .header-logo {
    flex-shrink: 0;
  }

  .logo-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: var(--text-primary);
    transition: color 0.2s;
  }

  .logo-link:hover {
    color: var(--primary);
  }

  .logo-icon {
    width: 1.5rem;
    height: 1.5rem;
  }

  .logo-text {
    font-size: 1.25rem;
    font-weight: 700;
  }

  /* Mobile Menu Toggle */
  .mobile-menu-toggle {
    display: none;
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    padding: 0.5rem;
    margin-left: auto;
  }

  .menu-icon {
    width: 1.5rem;
    height: 1.5rem;
  }

  /* Navigation */
  .header-nav {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex: 1;
  }

  .nav-link {
    color: var(--text-muted);
    text-decoration: none;
    font-weight: 500;
    font-size: 0.9375rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .nav-link:hover {
    color: var(--text-primary);
    background: var(--bg-hover);
  }

  .nav-link.active {
    color: var(--primary);
    background: var(--primary-light);
  }

  /* Actions */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-shrink: 0;
  }

  /* Theme Toggle Button */
  .theme-toggle-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s;
  }

  .theme-toggle-btn:hover {
    background: var(--bg-hover);
    color: var(--text-primary);
  }

  .theme-icon {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Show/hide icons based on theme */
  :root .sun-icon,
  [data-theme="workspace-light"] .sun-icon {
    display: block;
  }

  :root .moon-icon,
  [data-theme="workspace-light"] .moon-icon {
    display: none;
  }

  [data-theme="workspace-dark"] .sun-icon {
    display: none;
  }

  [data-theme="workspace-dark"] .moon-icon {
    display: block;
  }

  /* CTA Button */
  .cta-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1.25rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9375rem;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .cta-icon {
    width: 1.125rem;
    height: 1.125rem;
  }

  .cta-owner {
    background: var(--primary);
    color: white;
  }

  .cta-owner:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 208, 132, 0.3);
  }

  .cta-get-workspace {
    background: var(--primary);
    color: white;
  }

  .cta-get-workspace:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 208, 132, 0.3);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .mobile-menu-toggle {
      display: block;
    }

    .header-nav {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      flex-direction: column;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem;
      gap: 0.5rem;
      display: none;
    }

    .header-nav.active {
      display: flex;
    }

    .nav-link {
      width: 100%;
      padding: 0.75rem 1rem;
    }

    .header-container {
      padding: 1rem;
      gap: 1rem;
    }

    .cta-button {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
    }

    .cta-icon {
      width: 1rem;
      height: 1rem;
    }
  }

  @media (max-width: 480px) {
    .logo-text {
      font-size: 1.125rem;
    }

    .header-actions {
      gap: 0.5rem;
    }

    .cta-button span {
      display: none;
    }

    .cta-button {
      padding: 0.625rem;
    }
  }
</style>

<script>
  // Theme toggle functionality
  const themeToggle = document.getElementById('themeToggle');
  const html = document.documentElement;

  // Initialize theme from localStorage or system preference
  function initTheme() {
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      html.setAttribute('data-theme', savedTheme);
    } else {
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const defaultTheme = prefersDark ? 'workspace-dark' : 'workspace-light';
      html.setAttribute('data-theme', defaultTheme);
    }
  }

  // Toggle theme
  if (themeToggle) {
    themeToggle.addEventListener('click', () => {
      const currentTheme = html.getAttribute('data-theme');
      const newTheme = currentTheme === 'workspace-dark' ? 'workspace-light' : 'workspace-dark';
      html.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
    });
  }

  // Mobile menu toggle
  const mobileMenuToggle = document.getElementById('mobileMenuToggle');
  const headerNav = document.getElementById('headerNav');

  if (mobileMenuToggle && headerNav) {
    mobileMenuToggle.addEventListener('click', () => {
      headerNav.classList.toggle('active');
    });

    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!headerNav.contains(e.target as Node) && !mobileMenuToggle.contains(e.target as Node)) {
        headerNav.classList.remove('active');
      }
    });

    // Close mobile menu when clicking a link
    headerNav.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', () => {
        headerNav.classList.remove('active');
      });
    });
  }

  // Initialize theme on load
  initTheme();
</script>
